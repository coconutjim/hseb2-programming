<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE X3D PUBLIC "ISO//Web3D//DTD X3D 3.0//EN" "http://www.web3d.org/specifications/x3d-3.0.dtd">
<X3D xmlns:xsd='http://www.w3.org/2001/XMLSchema-instance' profile='Full' version='3.0' xsd:noNamespaceSchemaLocation='http://www.web3d.org/specifications/x3d-3.0.xsd'>
  <Scene DEF='scene'>
    <Viewpoint DEF='view1' position='0 0 12'/>
    <Viewpoint DEF='view2' position='0 0 20'/>
    <Background DEF='back' groundAngle='0.9 1.5 1.57' groundColor='0.6 0.7 0.1 0.4 0.7 0.2 0.1 0.6 0.1 0 0.3 0.1' skyAngle='0.9 1.5 1.57' skyColor='0.21 0.18 0.66 0.2 0.44 0.85 0.51 0.81 0.95 0.77 0.8 0.82'/>
    <Transform DEF='trans1' translation='-2 2 0'>
      <Viewpoint DEF='view3'/>
      <Shape>
        <Appearance>
          <Material diffuseColor='1 0 0'/>
        </Appearance>
        <Box/>
      </Shape>
    </Transform>
    <Transform DEF='trans2' translation='2 2 0'>
      <Shape>
        <Appearance>
          <Material diffuseColor='0 1 0'/>
        </Appearance>
        <Cone/>
      </Shape>
    </Transform>
    <Transform DEF='trans3' translation='-2 -2 0'>
      <Shape>
        <Appearance>
          <Material diffuseColor='0 0 1'/>
        </Appearance>
        <Cylinder/>
      </Shape>
    </Transform>
    <Transform DEF='trans4' translation='2 -2 0'>
      <Shape>
        <Appearance>
          <Material diffuseColor='1 1 0'/>
        </Appearance>
        <Sphere />
      </Shape>
    </Transform>
    <Transform DEF='tran' rotation='0 1 1 1.57' translation='0.1 0.2 -0.1'>
      <SphereSensor DEF='sphereSensor' />
      <Transform DEF='rotTrans'>
        <Shape>
          <Appearance>
            <GeneratedCubeMapTexture DEF='GCMT' update='always' size='512'>
              <TextureProperties containerField='textureProperties' boundaryModeS='CLAMP' boundaryModeT='CLAMP' boundaryModeR='CLAMP' magnificationFilter='linear' minificationFilter='linear'/>
            </GeneratedCubeMapTexture>
            <ComposedShader>
              <field accessType='inputOutput' name='cubes' type='SFInt32' value='0'/>
              <ShaderPart type='VERTEX'><![CDATA[
                                        void main()
                                        {
                                            gl_Position = ftransform();
                                            
                                            #if 1
                                                vec4 pos = vec4(gl_ModelViewMatrixInverse * vec4(0,0,0,1));
                                                vec3 eye = vec3(gl_Vertex - pos);
                                                gl_TexCoord[0] = vec4(reflect(eye, gl_Normal), 0);
                                            #else
                                                gl_TexCoord[0] = vec4(gl_Normal, 0);
                                            #endif
                                        }
                                        ]]>
              </ShaderPart>
              <ShaderPart type='FRAGMENT'><![CDATA[
                                        uniform samplerCube cubes;
                                        
                                        void main()
                                        {    
                                            gl_FragColor = 0.95 * textureCube(cubes, gl_TexCoord[0].stp);
                                        }
                                        ]]>
              </ShaderPart>
            </ComposedShader>
          </Appearance>
          <Teapot />
        </Shape>
      </Transform>
    </Transform>
    <ROUTE fromNode='sphereSensor' fromField='rotation_changed' toNode='rotTrans' toField='set_rotation'/>
    <TimeSensor DEF='ts' cycleInterval='10' loop='true' startTime='1'/>
    <OrientationInterpolator DEF='oi' key='0 0.25 0.5 0.75 1' keyValue='0 1 1 0 0 1 1 1.57 0 1 1 3.14 0 1 1 4.71 0 1 1 6.28'/>
    <ROUTE fromNode='oi' fromField='value_changed' toNode='trans1' toField='set_rotation'/>
    <ROUTE fromNode='ts' fromField='fraction_changed' toNode='oi' toField='set_fraction'/>
    <ROUTE fromNode='oi' fromField='value_changed' toNode='trans2' toField='set_rotation'/>
    <ROUTE fromNode='oi' fromField='value_changed' toNode='trans3' toField='set_rotation'/>
    <ROUTE fromNode='oi' fromField='value_changed' toNode='trans4' toField='set_rotation'/>
  </Scene>
</X3D>
